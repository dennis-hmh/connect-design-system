# To push updates to Concourse:
#   fly -t classcraft-ui-nonprod login --team-name classcraft-ui-nonprod --concourse-url https://concourse.tsg.hmhco.com
#   fly -t classcraft-ui-nonprod set-pipeline -p pr-validation-connect -c concourse/pipelines/pr-validation-connect.yml -v "namespace=classcraft-ui-nonprod" --load-vars-from=concourse/vars/pr-validation-connect-vars.yml

#################
# VAR SOURCES
#################
var_sources:
  - name: vault
    type: vault
    config:
      url: https://vault.br.internal
      namespace: ((namespace))
      path_prefix: secrets/
      auth_backend: approle
      auth_params:
        role_id: ((namespace-approle-secret.role_id))
        secret_id: ((namespace-approle-secret.secret_id))
      ca_cert: ((root_ca))

#################
# RESOURCE TYPES
#################
resource_types:
  - name: pull-request
    type: docker-image
    source:
      repository: docker.br.hmheng.io/concourse-resources/production/github-pr-resource
      tag: 1.0.0

#################
# RESOURCES
#################
x-source-template: &source-template
  branch: ((app_base_branch))
  uri: git@scm.eng.hmhco.com:Core-Digital-Production/((repo_name)).git
  private_key: ((vault:common/connect-gh.private-key))
  private_key_passphrase: ((vault:common/connect-gh.private-key-passphrase))
  skip_ssl_verification: true

resources:
  - name: connect-pr
    type: pull-request
    check_every: 24h
    webhook_token: ((vault:common/classcraft-gh.webhook-token))
    source:
      <<: *source-template
